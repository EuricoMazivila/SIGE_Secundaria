call addCandidato(4,'Ricardo Orlando','Manhice','2013-09-09','M',
'9','Diurno','Escola Secundaria Quisse Mavota','kamubukwana');

Com transacao 
Delimiter //
Create procedure addCandidato(_id_cand int,_nomes varchar(50), _apelido varchar(50),_data_nascimento date,_sexo enum('M','F'),
_classe_matricular enum('8','9','10','11','12'),_regime enum('Diurno','Nocturno'), _escola_Origem varchar(50),_distrito_origem varchar(50))
Begin 
	declare id_esco int;
	declare id_matr int;
	declare usuario varchar(50);
	
	Start transaction; 
	select id_escola into id_esco from direcao_distrital,escola where designacao=_distrito_origem and nome_escola=_escola_Origem;
	Select id_matricula into id_matr from matricula where estado='Em curso' or estado='Pendente' and data_fim>=curdate();
	Select username into usuario from candidato_aluno where nome=_nomes and apelido=_apelido;	

	if((id_esco is not null) && (id_matr is not null)) then
		begin
			if(usuario is not null) then
				begin
					Select CONCAT(username,109) into usuario from candidato_aluno where nome=_nomes and apelido=_apelido;
					
					insert into candidato_aluno (id_candidato,id_escola,nome,apelido,data_nascimento,sexo,classe_matricular,
					regime,ano,username,senha) values (_id_cand,id_esco,_nomes,_apelido,_data_nascimento,_sexo,_classe_matricular,_regime,
					year(curdate()),usuario,AES_ENCRYPT('Euro','senha'));
					commit;
				end;
			else
				insert into candidato_aluno (id_candidato,id_escola,nome,apelido,data_nascimento,sexo,classe_matricular,
				regime,ano,username,senha) values (_id_cand,id_esco,_nomes,_apelido,_data_nascimento,_sexo,_classe_matricular,_regime,
				year(curdate()),CONCAT(_nomes,_apelido),AES_ENCRYPT('Euro','senha'));
				commit;
			end if;		
		end;
	else
		Select 'Cadastro invalido' as Mensagem;	
		rollback;
	end if;		
end;
//

