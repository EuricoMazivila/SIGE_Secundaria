Call addCandidato(14,'Jorge','8','9','Cidade de Maputo','Kamubukwana','Escola Secundaria Quisse Mavota','diurno','Euro');
 
Procedimento para adicionar Candidato
Sem transacao
Delimiter //
Create procedure addCandidato(_codCand int,_nome varchar(50), _classe_anterior enum('7','8','9','10','11','12'), 
_classe_matricular enum('8','9','10','11','12'),_provincia_origem varchar(50),_distrito_origem varchar(50), _escola_Origem varchar(50),_regime varchar(10), 
_senha varchar(10))
Begin 
	declare codEsco int;
	declare codmat int;
	
	select codEscola into codEsco from escola where nome_escola=_escola_Origem and escola.coddist=(Select distrito.coddist from provincia,distrito where provincia.codProv=distrito.codProv and provincia=_provincia_origem and distrito=_distrito_origem);  
	Select codmatr into codmat from matricula where estado='activa' or estado='em espera' and dataF>=curdate();
	
	if((codEsco is not null) && (codmat is not null) && (_classe_matricular>_classe_anterior)) then
		begin
			if(MONTH(curdate())>4) then
				insert into candidato_aluno (codCand,nome_completo,classe_anterior,classe_matricular,
				turno,codEscola,senha,estado,ano) values (_codCand,_nome, _classe_anterior,_classe_matricular,_regime,
				codEsco,AES_ENCRYPT(_senha,'senha'),default,(year(curdate())+1));
			else
				insert into candidato_aluno (codCand,nome_completo,classe_anterior,classe_matricular,
				turno,codEscola,senha,estado,ano) values (_codCand,_nome, _classe_anterior,_classe_matricular,_regime,
				codEsco,AES_ENCRYPT(_senha,'senha'),default,year(curdate()));
			end if;		
		end;
	else
		Select 'Cadastro invalido' as Mensagem;	
	end if;		
end;
//

Com transacao 
Delimiter //
Create procedure addCandidato(_codCand int,_nome varchar(50), _classe_anterior enum('7','8','9','10','11','12'), 
_classe_matricular enum('8','9','10','11','12'),_provincia_origem varchar(50),_distrito_origem varchar(50), _escola_Origem varchar(50),_regime varchar(10), 
_senha varchar(10))
Begin 
	declare codEsco int;
	declare codmat int;
	
	Start transaction; 
	select codEscola into codEsco from escola where nome_escola=_escola_Origem and escola.coddist=(Select distrito.coddist from provincia,distrito where provincia.codProv=distrito.codProv and provincia=_provincia_origem and distrito=_distrito_origem);  
	Select codmatr into codmat from matricula where estado='activa' or estado='em espera' and dataF>=curdate();
	
	if((codEsco is not null) && (codmat is not null) && (_classe_matricular>_classe_anterior)) then
		begin
			if(MONTH(curdate())>4) then
				insert into candidato_aluno (codCand,nome_completo,classe_anterior,classe_matricular,
				turno,codEscola,senha,estado,ano) values (_codCand,_nome, _classe_anterior,_classe_matricular,_regime,
				codEsco,AES_ENCRYPT(_senha,'senha'),default,(year(curdate())+1));
				commit;
			else
				insert into candidato_aluno (codCand,nome_completo,classe_anterior,classe_matricular,
				turno,codEscola,senha,estado,ano) values (_codCand,_nome, _classe_anterior,_classe_matricular,_regime,
				codEsco,AES_ENCRYPT(_senha,'senha'),default,year(curdate()));
				commit;
			end if;		
		end;
	else
		Select 'Cadastro invalido' as Mensagem;	
		rollback;
	end if;		
end;
//
